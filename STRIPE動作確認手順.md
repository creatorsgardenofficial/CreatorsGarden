# Stripe動作確認手順

## ✅ 価格ID設定完了後の確認手順

価格IDを設定したら、以下の手順で動作確認を行ってください。

---

## 📋 確認チェックリスト

- [ ] 価格IDが`.env.local`に正しく設定されている
- [ ] コメント（`#`）が外されている
- [ ] 価格IDが`price_`で始まっている
- [ ] サーバーを再起動した
- [ ] 動作確認が完了した

---

## 🚀 動作確認手順

### ステップ1: サーバーの再起動

環境変数を変更した場合は、**必ずサーバーを再起動**してください。

```bash
# サーバーが起動している場合は停止（Ctrl+C）
# その後、再起動
npm run dev
```

### ステップ2: プランページにアクセス

1. ブラウザで `http://localhost:3000/pricing` にアクセス
2. プラン選択ページが表示されることを確認

### ステップ3: Grow Planの確認

1. 「Grow Plan（¥200/月）」セクションを確認
2. 「プランを選択」ボタンが表示されていることを確認

### ステップ4: 決済セッションの作成テスト

1. 「プランを選択」ボタンをクリック
2. 以下のいずれかが表示されることを確認：

#### ✅ 正常な場合

- Stripeの決済画面（チェックアウトページ）が表示される
- 金額が「¥200」と表示される
- 請求期間が「月次」と表示される

#### ❌ エラーの場合

- エラーメッセージが表示される
- ブラウザのコンソール（F12）でエラーを確認

---

## 🔍 よくあるエラーと対処法

### エラー1: 「プランの価格IDが設定されていません」

**原因**: 価格IDが正しく設定されていない

**対処法**:
1. `.env.local`ファイルを確認
2. `STRIPE_PRICE_ID_GROW=price_...`が設定されているか確認
3. コメント（`#`）が外されているか確認
4. サーバーを再起動

### エラー2: 「Stripe公開キーが設定されていません」

**原因**: `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY`が設定されていない

**対処法**:
1. `.env.local`ファイルを確認
2. `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_...`が設定されているか確認
3. サーバーを再起動

### エラー3: 「Stripeシークレットキーが設定されていません」

**原因**: `STRIPE_SECRET_KEY`が設定されていない

**対処法**:
1. `.env.local`ファイルを確認
2. `STRIPE_SECRET_KEY=sk_test_...`が設定されているか確認
3. サーバーを再起動

### エラー4: Stripeの決済画面が表示されない

**原因**: 価格IDが無効、または価格が削除されている

**対処法**:
1. Stripeダッシュボードで価格が存在するか確認
2. 価格IDが正しいか確認
3. テストモードの価格IDを使用しているか確認（本番モードの価格IDは使用不可）

---

## 🧪 テストカードでの決済テスト

Stripeの決済画面が表示されたら、テストカードで決済をテストできます：

### テストカード番号

```
4242 4242 4242 4242
```

### その他の情報

- **有効期限**: 未来の日付（例: 12/25）
- **CVC**: 任意の3桁（例: 123）
- **郵便番号**: 任意（例: 12345）

### テスト結果

- 決済が成功すると、Webhookが呼び出されます
- ユーザーのプランが「grow」に更新されます
- プロフィールページでプラン情報が確認できます

---

## 📊 確認ポイント

### 1. 環境変数の確認

```bash
# .env.localファイルの内容を確認
cat .env.local
```

以下の項目が設定されていることを確認：
- `STRIPE_SECRET_KEY=sk_test_...`
- `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_...`
- `STRIPE_PRICE_ID_GROW=price_...`
- `NEXT_PUBLIC_BASE_URL=http://localhost:3000`

### 2. サーバーログの確認

サーバーを起動した際に、以下の警告が表示されていないか確認：

```
警告: STRIPE_SECRET_KEYが設定されていません。Stripe機能は動作しません。
警告: STRIPE_PRICE_ID_GROWが設定されていません。
```

警告が表示されている場合は、環境変数が正しく読み込まれていません。

### 3. ブラウザコンソールの確認

1. ブラウザでF12キーを押して開発者ツールを開く
2. 「Console」タブを開く
3. エラーメッセージがないか確認

---

## ✅ 動作確認が完了したら

1. プラン選択ページが正常に表示される
2. 「プランを選択」ボタンをクリックするとStripeの決済画面が表示される
3. テストカードで決済をテストできる

これで、Stripe決済機能の設定が完了です！🎉

---

## 📚 参考

- **Stripeテストカード**: https://stripe.com/docs/testing
- **Stripeダッシュボード**: https://dashboard.stripe.com

