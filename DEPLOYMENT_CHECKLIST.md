# デプロイ前チェックリスト

デプロイ前に以下の項目を確認してください。

## 環境変数の確認

### 必須項目

- [ ] `STRIPE_SECRET_KEY` - Stripeのシークレットキー（本番環境用）
- [ ] `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY` - Stripeの公開可能キー（本番環境用）
- [ ] `STRIPE_WEBHOOK_SECRET` - Stripe Webhookシークレット
- [ ] `STRIPE_PRICE_ID_GROW` - Growプランの価格ID
- [ ] `STRIPE_PRICE_ID_BLOOM` - Bloomプランの価格ID
- [ ] `NEXT_PUBLIC_BASE_URL` - 本番環境のURL（例: `https://yourdomain.com`）

### オプション項目

- [ ] `SMTP_HOST` - メール送信サーバー
- [ ] `SMTP_PORT` - メール送信ポート
- [ ] `SMTP_SECURE` - SSL/TLS設定
- [ ] `SMTP_USER` - SMTPユーザー名
- [ ] `SMTP_PASS` - SMTPパスワード
- [ ] `SMTP_FROM_EMAIL` - 送信元メールアドレス
- [ ] `SMTP_FROM_NAME` - 送信元名
- [ ] `NEXT_PUBLIC_A8_AD_CODE` - A8.net広告コード

## コードの確認

- [ ] ローカルでビルドが成功する（`npm run build`）
- [ ] ローカルでアプリケーションが起動する（`npm start`）
- [ ] エラーや警告がない
- [ ] テストが通る（もしテストがある場合）

## セキュリティの確認

- [ ] `.env.local`が`.gitignore`に含まれている
- [ ] 機密情報がコードにハードコードされていない
- [ ] セキュリティヘッダーが設定されている（`next.config.ts`で確認済み）

## Stripe設定の確認

- [ ] Stripeダッシュボードで本番環境のAPIキーを取得
- [ ] 本番環境用の価格IDを作成
- [ ] WebhookエンドポイントのURLを確認（`https://yourdomain.com/api/webhooks/stripe`）

## データの確認

- [ ] 重要なデータのバックアップを取得
- [ ] データベース移行が必要な場合は準備済み

## デプロイ後の確認項目

### 基本動作

- [ ] ホームページが表示される
- [ ] ユーザー登録ができる
- [ ] ログインができる
- [ ] 投稿の作成・閲覧ができる
- [ ] コメント機能が動作する

### 決済機能

- [ ] Stripe決済が動作する（テストモードで確認）
- [ ] Webhookが正しく動作する
- [ ] プラン変更ができる

### メール機能

- [ ] メール送信が動作する（パスワードリセットなど）
- [ ] メールの内容が正しく表示される

### その他

- [ ] 広告が表示される（A8.net設定時）
- [ ] モバイル表示が正しい
- [ ] ダークモードが動作する

## トラブルシューティング

### ビルドエラーが発生する場合

```bash
# ローカルでビルドをテスト
npm run build

# エラーを確認して修正
```

### 環境変数が反映されない場合

- Vercelの場合: プロジェクト設定の「Environment Variables」で再確認
- 環境変数を追加・変更した場合は再デプロイが必要

### データが保存されない場合

- Vercelなどのサーバーレス環境では、ファイルシステムへの書き込みが一時的
- データベースへの移行を検討

## 次のステップ

デプロイが完了したら：

1. 本番環境での動作確認
2. Stripe Webhookの設定
3. ドメインの設定（カスタムドメインを使用する場合）
4. 監視とログの設定
5. バックアップ戦略の確立

